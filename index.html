<section class="reviews" aria-label="Customer reviews">
  <!-- Optional arch background. Delete this <img> for pure transparency. -->
  <img
    class="bg"
    src="https://YOUR-CDN.example.com/arch-beige-bottom.svg"
    alt=""
    aria-hidden="true"
    onerror="this.remove()"
  />

  <div class="container">
    <div class="shell">
      <button class="nav prev" aria-label="Previous reviews">‹</button>
      <div class="viewport">
        <ul class="track" id="track" aria-live="polite"></ul>
      </div>
      <button class="nav next" aria-label="Next reviews">›</button>
    </div>

    <div class="brands"><span>Google</span> · <span>ClickMechanic</span></div>
  </div>
</section>

<style>
  :root{
    --text:#1D1D1F;
    --card:#fff;
    --gap:24px;
    --radius:16px;
    --sidepad:72px;
  }
  *{box-sizing:border-box}

  /* Hard-kill any host frame/shadow/background */
  .reviews, .reviews *{
    background:transparent !important;
    border:0 !important;
    outline:0 !important;
    box-shadow:none !important;
  }

  .reviews{
    position:relative;
    overflow:hidden;             /* no inner scroll trapping */
    padding:18px 0 10px;         /* compact top/bottom like your ref */
    color:var(--text);
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }

  /* Optional arch image behind content */
  .reviews > .bg{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:cover; object-position:center;
    pointer-events:none; user-select:none; display:block;
  }

  .container{max-width:1120px;margin:0 auto;padding:0 16px;position:relative;z-index:1}

  .shell{position:relative;padding:0 var(--sidepad)}
  .viewport{overflow:hidden;border-radius:20px;touch-action:pan-y}
  .track{display:flex;gap:var(--gap);margin:0;padding:0;list-style:none;transition:transform .55s ease}

  /* Card */
  .card{
    background:var(--card);
    border-radius:var(--radius);
    padding:20px;
    display:flex;flex-direction:column;
    min-height:180px;
    /* width is set per-breakpoint below via flex-basis */
    flex:0 0 auto;
  }
  .top{display:flex;align-items:center;gap:12px;margin-bottom:6px;min-height:28px}
  .name{font-weight:700;flex:1 1 auto;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .stars{flex:0 0 auto;width:6.6ch;text-align:right;letter-spacing:.06em}
  .stars .full{color:#1D1D1F}.stars .empty{color:#1D1D1F;opacity:.25}
  .verify{display:flex;align-items:center;gap:6px;font-size:13px;opacity:.9}
  .verify svg{width:14px;height:14px;display:block;fill:#1D1D1F}
  .body{margin-top:8px;line-height:1.45}

  .nav{
    position:absolute;top:50%;transform:translateY(-50%);
    width:46px;height:46px;border-radius:50%;cursor:pointer;
    background:#fff !important;color:#1D1D1F !important;
    display:grid;place-items:center;font-size:28px;line-height:1;
  }
  .prev{left:18px}
  .next{right:18px}

  .brands{display:flex;gap:10px;justify-content:flex-end;margin:10px var(--sidepad) 0 0}
  .brands span{font-size:14px;opacity:.75;font-weight:600}

  /* —— Responsive widths locked with flex-basis —— */

  /* Mobile: EXACTLY 1 card, no peeking */
  @media (max-width:639.98px){
    .track{gap:0}
    .card{flex:0 0 100%}
  }

  /* Tablet: EXACTLY 2 cards */
  @media (min-width:640px) and (max-width:1023.98px){
    .track{gap:var(--gap)}
    .card{flex:0 0 calc((100% - var(--gap)) / 2)}
  }

  /* Desktop: EXACTLY 4 cards */
  @media (min-width:1024px){
    .track{gap:var(--gap)}
    .card{flex:0 0 calc((100% - 3*var(--gap)) / 4)}
  }
</style>

<script>
(function(){
  const REVIEWS = [
    {name:"Michael A.", text:"This is the 3rd time that I’ve had Graeme service my car. He is punctual, detailed and a pleasure to deal with.", rating:5},
    {name:"Eric W.", text:"All excellent. Delighted with the speed of service and MOT.", rating:5},
    {name:"Flow T.", text:"Helped me out multiple times when my car’s been trouble, would 100% recommend to anyone!!", rating:5},
    {name:"Gabrielle L.", text:"Very happy. Great price for the work, much better than bigger name brand use again.", rating:5},
    {name:"Jay T.", text:"Great friendly service. I’ve been using Maxamy for nearly 11 years now. Very competitive prices.", rating:5},
    {name:"Dan B.", text:"Super experienced. Turned up on time and did the job quickly and correctly.", rating:5}
  ];

  const track  = document.getElementById('track');
  const prev   = document.querySelector('.prev');
  const next   = document.querySelector('.next');
  const viewport = document.querySelector('.viewport');

  function stars(n){
    return `<span class="stars" aria-label="${n} out of 5 stars">
              <span class="full">${'★'.repeat(n)}</span><span class="empty">${'★'.repeat(5-n)}</span>
            </span>`;
  }
  const tick = `<svg viewBox="0 0 16 16" aria-hidden="true"><path d="M8 1.25a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5Zm-1 8.01L4.97 7.23l.99-.99L7 7.28 9.99 4.3l.99.99L7 9.26Z"/></svg>`;

  function card({name,text,rating}){
    return `<li class="card">
      <div class="top"><div class="name">${name}</div>${stars(rating)}</div>
      <div class="verify">${tick}<span>Verified Customer</span></div>
      <div class="body">${text}</div>
    </li>`;
  }
  track.innerHTML = REVIEWS.map(card).join('');

  // Clone ends for seamless loop
  const perViewMax = 4;
  const originals = Array.from(track.children);
  originals.slice(0, perViewMax).forEach(el => track.appendChild(el.cloneNode(true)));
  originals.slice(-perViewMax).forEach(el => track.insertBefore(el.cloneNode(true), track.firstChild));

  let index = perViewMax, step = 0;

  function currentGap(){
    const s = getComputedStyle(track);
    return parseFloat(s.columnGap || s.gap) || 0;
  }
  function recalc(){
    const ref = track.children[perViewMax];
    if(!ref) return;
    step = ref.getBoundingClientRect().width + currentGap(); // exact card width + gap
    move(index,false);
  }
  function move(i, animate=true){
    track.style.transition = animate ? 'transform .55s ease' : 'none';
    track.style.transform = `translateX(${-i * step}px)`;
    index = i;
  }

  function goNext(){ move(index+1,true); }
  function goPrev(){ move(index-1,true); }

  track.addEventListener('transitionend', ()=>{
    const start = perViewMax;
    const end   = start + originals.length - 1;
    if (index > end) move(start + (index - end - 1), false);
    if (index < start) move(end - (start - index - 1), false);
  });

  // Touch swipe (no scroll trap)
  let sx=0, dx=0, touching=false;
  viewport.addEventListener('touchstart', e=>{ touching=true; sx=e.touches[0].clientX; dx=0; track.style.transition='none'; }, {passive:true});
  viewport.addEventListener('touchmove',  e=>{ if(!touching) return; dx=e.touches[0].clientX - sx; track.style.transform=`translateX(${-index*step - dx}px)`; }, {passive:true});
  viewport.addEventListener('touchend',   ()=>{ touching=false; Math.abs(dx)>step*0.25 ? (dx<0?goNext():goPrev()) : move(index,true); });

  prev.addEventListener('click', goPrev);
  next.addEventListener('click', goNext);

  window.addEventListener('resize', recalc);
  if (document.fonts && document.fonts.ready) document.fonts.ready.then(recalc);

  recalc();
  move(index,false);
})();
</script>
